<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internet Speed Test</title>
    <!-- Tailwind CSS CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter for a clean look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Ensure the body takes full viewport height and centers content */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f2f5; /* Light gray background */
        }
        /* Custom styles for potential future use or overrides */
        .container {
            max-width: 90%; /* Responsive width */
        }
        @media (min-width: 768px) {
            .container {
                max-width: 600px; /* Max width for larger screens */
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <!-- Main container for the speed test app -->
    <div class="container bg-white p-8 rounded-xl shadow-lg text-center border border-gray-200">
        <h1 class="text-4xl font-extrabold text-gray-800 mb-6 tracking-tight">
            Internet Speed Test
        </h1>

        <!-- Display area for speed metrics -->
        <div class="flex flex-col md:flex-row justify-around items-center space-y-6 md:space-y-0 md:space-x-6 mb-8">
            <!-- Download Speed -->
            <div class="speed-item bg-blue-50 p-6 rounded-lg w-full md:w-1/3 shadow-sm border border-blue-100">
                <p class="text-sm text-blue-600 font-medium mb-2">Download Speed</p>
                <h2 id="download-speed" class="text-4xl font-bold text-blue-700">0.00 Mbps</h2>
            </div>

            <!-- Upload Speed (Placeholder) -->
            <div class="speed-item bg-green-50 p-6 rounded-lg w-full md:w-1/3 shadow-sm border border-green-100">
                <p class="text-sm text-green-600 font-medium mb-2">Upload Speed</p>
                <h2 id="upload-speed" class="text-4xl font-bold text-green-700">0.00 Mbps</h2>
            </div>

            <!-- Latency -->
            <div class="speed-item bg-purple-50 p-6 rounded-lg w-full md:w-1/3 shadow-sm border border-purple-100">
                <p class="text-sm text-purple-600 font-medium mb-2">Latency</p>
                <h2 id="latency" class="text-4xl font-bold text-purple-700">0 ms</h2>
            </div>
        </div>

        <!-- Button to start the test -->
        <button id="startButton"
                class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:from-indigo-600 hover:to-purple-700 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-300">
            Start Test
        </button>

        <!-- Status message display -->
        <p id="status" class="mt-6 text-lg text-gray-600 font-medium">Click "Start Test" to begin.</p>
    </div>

    <script>
        // Ensure the DOM is fully loaded before running the script
        document.addEventListener('DOMContentLoaded', () => {
            // Get references to HTML elements
            const startButton = document.getElementById('startButton');
            const downloadSpeedElem = document.getElementById('download-speed');
            const uploadSpeedElem = document.getElementById('upload-speed');
            const latencyElem = document.getElementById('latency');
            const statusElem = document.getElementById('status');

            // Add event listener to the start button
            startButton.addEventListener('click', () => {
                // Reset display and show status message
                statusElem.textContent = 'Testing... Please wait. This may take a moment.';
                downloadSpeedElem.textContent = '...';
                uploadSpeedElem.textContent = '...';
                latencyElem.textContent = '...';
                startButton.disabled = true; // Disable button during test

                // Run the main speed test function
                runSpeedTest();
            });

            /**
             * Main function to execute the internet speed test.
             * It measures latency, download speed, and provides a placeholder for upload speed.
             */
            async function runSpeedTest() {
                // URL for a dummy file to test download speed.
                // Using Cloudflare's test file for reliability. It's 100MB.
                const testFileUrl = 'https://speed.cloudflare.com/__down?bytes=100000000';
                const fileSizeInBytes = 100 * 1024 * 1024; // 100 MB in bytes

                try {
                    // --- Latency Test ---
                    statusElem.textContent = 'Measuring Latency...';
                    let latencyTotal = 0;
                    const latencyCount = 5; // Number of requests for latency average

                    for (let i = 0; i < latencyCount; i++) {
                        const startTime = performance.now(); // High-resolution time
                        // Use a HEAD request for latency as it's faster (only fetches headers)
                        await fetch(testFileUrl, { method: 'HEAD', cache: 'no-store' });
                        const endTime = performance.now();
                        latencyTotal += (endTime - startTime);
                    }
                    const avgLatency = Math.round(latencyTotal / latencyCount);
                    latencyElem.textContent = `${avgLatency} ms`;

                    // --- Download Test ---
                    statusElem.textContent = 'Measuring Download Speed...';
                    const downloadStartTime = performance.now();
                    const response = await fetch(testFileUrl, { cache: 'no-store' }); // Prevent caching
                    
                    // Check if the response is OK (status 200-299)
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    // Read the response body as a blob to ensure full download
                    const blob = await response.blob();
                    const downloadEndTime = performance.now();

                    // Calculate download speed
                    const durationInSeconds = (downloadEndTime - downloadStartTime) / 1000;
                    // Speed in Mbps: (fileSizeInBytes / (1024 * 1024)) converts bytes to MB,
                    // then divide by seconds, then multiply by 8 to convert MB/s to Mbps.
                    const speedInMbps = (fileSizeInBytes / (1024 * 1024)) / durationInSeconds * 8;
                    downloadSpeedElem.textContent = `${speedInMbps.toFixed(2)} Mbps`;

                    // --- Upload Test (Placeholder) ---
                    // A true upload test requires a backend server to receive the data.
                    // For a front-end only application, we'll provide a placeholder.
                    statusElem.textContent = 'Upload Speed requires a backend server. Showing placeholder...';
                    uploadSpeedElem.textContent = 'N/A'; // Not Applicable without backend
                    // If you were to implement a simplified upload test without a backend,
                    // you could measure how long it takes to create a large blob or send it
                    // to a dummy endpoint that immediately responds, but this wouldn't reflect
                    // actual network upload speed.
                    // Example (conceptual, not a real upload test):
                    /*
                    const uploadDataSize = 10 * 1024 * 1024; // 10 MB dummy data
                    const dummyData = new Blob([new ArrayBuffer(uploadDataSize)]);
                    const uploadStartTime = performance.now();
                    // Simulate sending data (e.g., to a non-existent endpoint or a mock service)
                    // await fetch('/dummy-upload-endpoint', { method: 'POST', body: dummyData });
                    const uploadEndTime = performance.now();
                    const uploadDurationInSeconds = (uploadEndTime - uploadStartTime) / 1000;
                    const uploadSpeedInMbps = (uploadDataSize / (1024 * 1024)) / uploadDurationInSeconds * 8;
                    uploadSpeedElem.textContent = `${uploadSpeedInMbps.toFixed(2)} Mbps`;
                    */

                    statusElem.textContent = 'Test complete! Click "Start Test" to run again.';
                } catch (error) {
                    // Handle any errors during the test
                    statusElem.textContent = `Test failed: ${error.message}. Please try again.`;
                    console.error('Speed test error:', error);
                    // Reset speeds to 0 or error state
                    downloadSpeedElem.textContent = 'Error';
                    uploadSpeedElem.textContent = 'Error';
                    latencyElem.textContent = 'Error';
                } finally {
                    // Re-enable the button regardless of success or failure
                    startButton.disabled = false;
                }
            }
        });
    </script>
</body>
</html>
